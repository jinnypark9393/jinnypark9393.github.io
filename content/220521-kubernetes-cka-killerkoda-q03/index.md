---
emoji: π”§
title:  'μΏ λ²„λ„¤ν‹°μ¤(Kubernetes) CKA - KillerKoda Q3. Apiserver Misconfigured'
date: '2022-05-21 06:00:00'
author: jinnypark9393
tags: kubernetes
categories: λ°λΈμµμ¤
---

# Q3. APIμ„λ²„ μ„¤μ • μ¤λ¥

λ¨Όμ €, APIμ„λ²„ μ¥μ•  μ‹¤μµμ„ ν’€μ§€ μ•μ•λ‹¤λ©΄ ν’€κ³  μ¤λ„λ΅ ν•μ.

<br/>

API μ„λ²„κ°€ μ¬λΌμ¤μ§€ μ•λ” μƒν™©μ΄λ‹¤. λ§¤λ‹νμ¤νΈ νμΌμ 3κ³³μ΄ μλ» μ„¤μ •λμ–΄μλ‹¤. μ—λ¬λ¥Ό μμ •ν•μ.

<br/><br/>

## λ΅κ·Έ κ²½λ΅

ν™•μΈν•΄μ•Όν•  λ΅κ·Έ κ²½λ΅λ” μ•„λμ™€ κ°™λ‹¤.

- `/var/log/pods`
- `/var/log/containers`
- `crictl ps` + `crictl logs`
- `docker ps` + `docker logs` (λ„μ»¤κ°€ μ‚¬μ©λ  κ²½μ°)
- kubelet λ΅κ·Έ: `/var/log/syslog` νΉμ€ `journalctl`

<br/><br/>

## μ΄μ

λ³€κ²½μ‚¬ν•­μ„ μ μ©ν•κΈ° μ„ν•΄ λ‹¤μμ μ‘μ—…μ„ ν•΄μ•Όν•  μ μλ‹¤.

1. `kube-apiserver.yaml` νμΌμ„ manifests λ””λ ‰ν† λ¦¬μ—μ„ λΊ€λ‹¤
2. API μ„λ²„ μ»¨ν…μ΄λ„κ°€ μ‚¬λΌμ§λ•κΉμ§€ κΈ°λ‹¤λ¦°λ‹¤ (`watch crictl ps` )
3. λ§¤λ‹νμ¤νΈ νμΌμ„ λ‹¤μ‹ λλ ¤λ†“μ€ λ’¤ apiμ„λ²„κ°€ λμ•„μ¬ λ•κΉμ§€ κΈ°λ‹¤λ¦°λ‹¤.

μΌλ¶€ μ μ €λ“¤μ΄ kubeletμ„ μ¬μ‹μ‘ν•΄μ•Όν–λ‹¤κ³  λ³΄κ³  ν–μΌλ‚(`service kubelet restart`) μ΄λ΅ μƒμΌλ΅λ” ν•„μ”μ—†λ‹¤.

<br/><br/>

## ν•΄κ²° λ°©λ²• 1

Kubeletμ΄ νλ“/μ»¨ν…μ΄λ„λ¥Ό μ‹μ‘λ„ μƒμ„±ν•μ§€λ„ λ»ν•κ³  μλ‹¤. Kubeletλ΅κ·Έλ¥Ό syslogλ΅ ν™•μΈν•΄λ³΄μ.

```jsx
cat /var/log/syslog | grep kube-apiserver
```

<br/>

- manifestνμΌμ metadata λ¶€λ¶„μ— μ¤νƒ€κ°€ μλ‹¤
    - `metadata;` λ¥Ό `metadata:` λ΅ μμ •ν•΄μ¤€λ‹¤.

<br/><br/>

## ν•΄κ²° λ°©λ²• 2

μλ»λ YAMLμ„ μμ •ν• λ’¤μ—λ„ μ—¬μ „ν ν‹€λ„μλ»λ νλΌλ―Έν„°λ΅ μ΄μκ°€ μλ” λ“― ν•λ‹¤.

- `/var/log/pods` μ— μλ” λ΅κ·Έλ¥Ό ν™•μΈν•μ.
- μ—λ¬: `Error: unknown flag: β€”authorization-modus`
- λ§λ” νλΌλ―Έν„°: `β€”authorization-mode`

<br/><br/>

## ν•΄κ²° λ°©λ²• 3

νλΌλ―Έν„°λ¥Ό κ³ μΉ λ’¤, νλ“/μ»¨ν…μ΄λ„λ” upλμ—μ„ μ μμ§€λ§, νλ“κ°€ μ¬μ‹μ‘(restart) λλ” ν„μƒμ΄ λ°μƒν•λ‹¤.

<br/>

μ»¨ν…μ΄λ„ λ΅κ·Έλ¥Ό ν™•μΈν•κ±°λ‚ `/var/log/pods` λ¥Ό ν™•μΈν•λ©΄ μ•„λλ¥Ό μ°Ύμ„ μ μλ‹¤.

```jsx
Error while dialing dial tcp 127.0.0.1:23000: connect:connection refused
```

<br/>

μ»¨ν…μ΄λ„ λ΅κ·Έλ¥Ό ν™•μΈν•μ: ETCD μ—°κ²°μ΄ μλ»λ λ“― ν•λ‹¤. ETCDκ°€ λ™μ‘ν•λ” μ¬λ°”λ¥Έ ν¬νΈλ¥Ό μ„¤μ •ν•μ(ν¬νΈ λ²νΈλ” ETCD λ§¤λ‹νμ¤νΈλ¥Ό ν™•μΈν•μ).

<br/>

μ„¤μ •κ°’μ€ `β€”etcd-servers=https://127.0.0.1:2379` μ—¬μ•Ό ν•λ‹¤(μμ„Έν• λ‚΄μ©μ€ μΏ λ²„λ„¤ν‹°μ¤ κ³µμ‹λ¬Έμ„μ Ports and Protocols λ¬Έμ„λ¥Ό ν™•μΈν•μ).

<br/>