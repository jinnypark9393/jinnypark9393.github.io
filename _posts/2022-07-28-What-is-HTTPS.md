---

published: true
title:  "[Network/Security]HTTPS의 정의 및 작동방식"
excerpt: "HTTPS란 SSL/TLS 프로토콜과 HTTP를 조합한 통신 프로토콜이며, 대칭키와 비대칭키(공개키)방식을 혼합하여 데이터를 안전하게 전송한다"

categories:
- DevOps
tags:
- [인프라엔지니어, SRE, DevOps, http란, https란, 대칭키란, 비대칭키란, 공개키란, https의정의, https작동방식]

toc: true
toc_sticky: true

date: 2022-07-28
last_modified_at: 2022-07-28

---

<br/><br/>

# 1. HTTP란?

- HTTP란 Hyper Text Transfer Protocol로서, Hyper Text 를 전송하기 위해 만들어진 프로토콜이다.
- 클라이언트(웹 브라우저)와 서버 사이의 요청/응답에 사용된다.
- 예: http://naver.com → naver.com과 통신 시 HTTP 프로토콜을 활용해 통신하겠다는 의미

<br/><br/>

## HTTP의 한계

1. 암호화되지 않은 통신이기 때문에 데이터가 탈취될 수 있다.
    - 통신 경로 상의 외부 소유 네트워크 기기 혹은 케이블을 통해 통신 내용이 탈취 될 수 있다.
2. 통신 상대를 확인하지 않기 때문에 위장할 수 있다.
    - Request를 보낸 클라이언트를 확신할 수 없다. HTTP는 누가 요청을 보내건 응답하는 구조이므로 신원이 보장된 특정 클라이언트와만 통신할 수 없다.
    - 대량 요청을 통한 DDoS 공격의 위험이 있다.
    - Response를 보낸 서버를 확신 할 수 없으며, 응답을 보낸 서버가 내가 원하는 서버인 지 알 수 없다. 위장서버일 수 있다.
3. 완전성(정보의 정확성)을 증명할 수 없어 변조할 수 있다.
    - 클라이언트와 서버가 보낸 정보를 중간에 가로채 데이터를 변경할 위험이 있다.

<br/><br/>

# 2. HTTPS란?

- HTTP의 보안 취약점을 보완하고자 보안 프로토콜인 SSL/TLS 프로토콜을 조합한 것
- HTTP 통신의 소켓 부분을 SSL이나 TLS 프로토콜로 대체한다.

<br/><br/>

## 1. SSL/TLS란?

- SSL(Secure Socket Layer)
    - HTTP와 독립된 프로토콜
    - HTTP외에도 다양한 상황에서 사용
- TLS(Transport Layer Security)
    - SSL이 IETF의 관리하에 들어가면서 TLS로 이름이 변경(TLS1.0 ⇒ SSL3.0을 계승)
    - 현재도 TLS 대신 SSL이라는 용어를 혼용해서 사용하고 있다.

<br/>

## 2. 대칭키의 정의 및 장단점

- **대칭키란?** 암복호화에 사용하는 키가 동일한 암호화 방식
- 장점: 속도가 빠르고 비대칭키에 비해 컴퓨팅 파워가 적게 소모된다.
- 단점: 탈취의 위험이 있다.

<br/>

## 3. 비대칭키의 정의 및 장단점

- **비대칭키란?** 암호화와 복호화에 사용하는 키가 서로 다르다.
- 장점: 대칭키에 비해 탈취의 위험이 적으며, 인증의 기능도 제공한다.
- 단점: 속도가 느리고 대칭키에 비해 컴퓨팅 파워가 많이 소모된다.

<br/>

## 4. HTTPS 통신의 예시

- HTTPS 통신에는 비대칭키와 대칭키 방식을 혼합하여 사용한다.
- HTTPS 통신에는 서버와 클라이언트 외에 CA라는 곳이 등장한다.

<br/>

### CA(Certificate Authority)란?

- 공인된 기관에서 서버가 믿을 수 있는 서버인지 보증하는 SSL 보증서를 발급한다.
    - CA기관마다 보안 강도가 다를 수 있음(보안 수준이 높은 곳은 사업자등록증 등 요구)
- 자체 CA(사설 CA: self-signed CA)로도 SSL 인증서를 발급할 수 있다.
    - HTTPS 통신이나 브라우저에서 안전하지 않다고 판단해 주소창에 “안전하지 않음” 메시지를 띄우게 된다.

<br/>

### HTTPS 통신 방법

1. 웹사이트(서버)가 CA에 인증을 요청한다(CSR: Certificate Signing Request)
2. CA에서 검증을 거친 후 사이트 정보와 **사이트 공개키**를 **인증기관의 개인키**로 암호화하여 사이트 인증서를 제작한다.
    - 사이트 인증서 = 사이트 공개키 + 인증기관 개인키
3. 사이트(서버)로 인증서를 발급한다.
4. 인증기관(CA)은 웹 브라우저(클라이언트)에 자신의 공개키를 제공한다.
    - 웹 브라우저 = **CA의 공개키** 저장
5. 웹 브라우저(클라이언트)에서 사이트(서버)로 접속을 요청한다.
6. 사이트(서버)에서 발급받은 인증서를 전달한다.
7. 웹 브라우저(클라이언트)에 저장되어있던 CA공개키로 인증서를 검증한다.
8. 사이트 정보와 공개키를 획득한다.
9. 획득한 사이트 공개키로 대칭키를 암호화하여 전달한다.
10. 사이트 개인키로 해독하여 대칭키를 획득한다.
11. 안전하게 전달된 대칭키를 이용하여 암호문을 주고받는다.

<br/>

## www.naver.com으로 접속 시 정상 사이트인지 피싱인지 어떻게 검증할까?

1. Handshaking
    1. Client Hello: 클라이언트가 서버에 전송하는 데이터
        1. 클라이언트 측에서 생성한 랜덤 바이트
        2. 클라이언트 - 서버 암호화 방식 통일을 위해 클라이언트가 사용할 수 있는 암호화 방식들
        3. 이미 Handshaking 기록이 있다면 기존 세션을 재활용하기 위한 세션 아이디(자원 절약)
    2. Server Hello: Client Hello에 대한 응답으로 서버측에서 클라이언트로 전송할 데이터
        1. 서버 측에서 생성한 랜덤 바이트
        2. 서버가 선택한 클라이언트 암호화 방식
        3. SSL 인증서
    3. Client 인증 확인
        1. 전달받은 인증서가 CA에서 발행한 인증서인지 가지고 있는 목록에서 확인하고, 목록에 있다면 CA 공개키로 복호화
        2. 클라이언트 - 서버 각각의 랜덤 바이트를 조합해 pre-master-secret값(데이터 송수신에 사용한 대칭키 암호화용 키)
        3. Pre master secret 값을 공개키 방식으로 서버 전달(공개키는 서버로부터 받은 인증서에 포함)
        4. 일련의 과정을 거쳐 세션 키 생성
    4. 서버 인증 확인
        1. 서버는 비공개키로 복호화하여 pre master secret값 취득(대칭키 공유 완료)
        2. 일련의 과정을 거쳐 세션 키 생성
    5. Handshaking종료
2. 데이터 전송
    1. 서버 및 클라이언트는 세션키를 활용해 데이터를 암/복호화하여 데이터 송수신
3. 연결 종료 및 세션키 폐기

<br/><br/>
